/**
 * Created by zhouzechen on 16/9/27.
 */
!function(a){function b(a){for(var b=0,c=a.length;b<c;b++)if("undefined"!=typeof d.style[a[b]])return a[b]}function c(b,c){var d=[b,"-webkit-"+b,"-moz-"+b,"-o-"+b,"-ms-"+b],e={};return a.each(d,function(a,b){e[b]=c}),e}var d=document.createElement("div"),e="transform WebkitTransform MozTransform OTransform msTransform".split(" "),f=b(e),g="transitionDuration WebkitTransitionDuration MozTransitionDuration OTransitionDuration msTransitionDuration".split(" ");b(g);a.fn.jTouch=function(b){function d(a){return"undefined"!=typeof h.viewLimit.xMin&&a<=h.viewLimit.xMin?h.viewLimit.xMin:"undefined"!=typeof h.viewLimit.xMax&&a>=h.viewLimit.xMax?h.viewLimit.xMax:a}function e(a){return"undefined"!=typeof h.viewLimit.yMin&&a<=h.viewLimit.yMin?h.viewLimit.yMin:"undefined"!=typeof h.viewLimit.yMax&&a>=h.viewLimit.yMax?h.viewLimit.yMax:a}var g=this,h=a.extend(!0,{observer:a(document),keyWatch:!0,delay:50,viewLimit:{xMin:void 0,xMax:void 0,yMin:void 0,yMax:void 0},keyDelta:5,touchReverse:!1},b),i={start:{}},j=void 0!==document.ontouchmove,k={ob:a(h.observer),x:0,y:0,el:g,perspectiveRate:1,perspective:null,changeDistance:function(a){k.perspectiveRate=a,k.perspective||(k.perspective=k.el.parent().css("perspective"),k.perspective&&(k.perspective=parseFloat(k.perspective))),k.perspective&&k.el.parent().css("perspective",k.perspective*k.perspectiveRate)},move:function(a){a&&("number"==typeof a.x&&(this.x=d(a.x)),"number"==typeof a.y&&(this.y=e(a.y)));
//console.log('move :x[' + this.x + '],y[' + this.y + ']');
var b=h.touchReverse?-1:1;this.el[0].style[f]="rotateX("+b*this.x+"deg) rotateY("+b*this.y+"deg)",this.overResetCheck()},aniMove:function(a){this.el.css(c("transition","transform 200ms ease")),this.move(a)},overResetCheck:function(){},reset:function(){this.move({x:0,y:0})}},l="webkitTransitionEnd mozTransitionEnd oTransitionEnd transitionend";return k.el.on(l,function(){k.el.css(c("transition","none"))}),k.duration=function(){return h.delay||0}(),h.keyWatch&&a(document).keydown(function(a){switch(a.keyCode){case 37:// left
k.aniMove({y:k.y-h.keyDelta});break;case 38:// up
a.preventDefault(),k.aniMove({x:k.x+h.keyDelta});
//viewport.changeDistance(viewport.perspectiveRate + 0.1);
break;case 39:// right
k.aniMove({y:k.y+h.keyDelta});break;case 40:// down
a.preventDefault(),k.aniMove({x:k.x-h.keyDelta});
//viewport.changeDistance(viewport.perspectiveRate - 0.1);
break;case 27://esc
k.reset()}}),k.ob.bind("mousedown touchstart",function(b){return delete i.last,!!a(b.target).is("a, iframe")||(b.originalEvent.touches?b=b.originalEvent.touches[0]:null,i.start.x=b.pageX,i.start.y=b.pageY,k.ob.bind("mousemove touchmove",function(a){
// Only perform rotation if one touch or mouse (e.g. still scale with pinch and zoom)
j&&a.originalEvent&&a.originalEvent.touches.length>1||(a.preventDefault(),
// Get touch co-ords
a.originalEvent.touches?a=a.originalEvent.touches[0]:null,k.el.trigger("move-viewport",{x:a.pageX,y:a.pageY}))}),void k.ob.bind("mouseup touchend",function(){k.ob.unbind("mousemove touchmove")}))}),k.el.bind("move-viewport",function(a,b){function c(a,b){return a>=b}
// Reduce movement on touch screens
//var movementScaleFactor = touch ? 4 : 1;
var d=j?4:5;i.last?(c(i.start.x,i.last.x)!=c(i.last.x,b.x)&&(i.start.x=i.last.x),c(i.start.y,i.last.y)!=c(i.last.y,b.y)&&(i.start.y=i.last.y)):i.last=i.start,k.move({x:k.x+parseInt((b.y-i.start.y)/d),y:k.y-parseInt((b.x-i.start.x)/d)}),i.last.x=b.x,i.last.y=b.y}),g}}(jQuery),/**
 * Created by zhouzechen on 16/9/27.
 */
function(a){a.fn.jCube=function(b){function c(b,c){var d=[b,"-webkit-"+b,"-moz-"+b,"-o-"+b,"-ms-"+b],e={};return a.each(d,function(a,b){e[b]=c}),e}function d(b,d){if(!k){k=a('<div class="'+n.cubeClass+'"></div>'),k.css({position:"absolute",left:0,right:0,top:0,bottom:0}),k.css(c("transformStyle","preserve-3d")),k.css(c("transformOrigin","50% 50% 0"));var e=a('<div class="'+n.cubeClass+"-wall "+n.cubeClass+'-front"></div>'),f=a('<div class="'+n.cubeClass+"-wall "+n.cubeClass+'-back"></div>'),g=a('<div class="'+n.cubeClass+"-wall "+n.cubeClass+'-left"></div>'),i=a('<div class="'+n.cubeClass+"-wall "+n.cubeClass+'-right"></div>'),j=a('<div class="'+n.cubeClass+"-wall "+n.cubeClass+'-top"></div>'),m=a('<div class="'+n.cubeClass+"-wall "+n.cubeClass+'-bottom"></div>');k.append(e),k.append(f),k.append(g),k.append(i),k.append(j),k.append(m),k.surrounds={front:e,back:f,left:g,right:i,top:j,bottom:m},a(">div",k).css(a.extend({position:"absolute",top:0,left:0},c("userSelect","none"))),m.css({top:"auto",bottom:0}),h(k.surrounds.back,n.attach.back),h(k.surrounds.front,n.attach.front),h(k.surrounds.left,n.attach.left),h(k.surrounds.right,n.attach.right),h(k.surrounds.top,n.attach.top),h(k.surrounds.bottom,n.attach.bottom),l.append(k)}}function e(b,d){var e=2*b*n.perspectiveRate;m&&(e=3*b*n.perspectiveRate),l.css(a.extend({marginLeft:-b/2,marginTop:-d/2,width:b,height:d},c("perspective",e)));var f=b/2;k.surrounds.back.css(a.extend({width:b,height:d},c("transform","rotateY(-180deg) translateZ("+f+"px)"))),k.surrounds.front.css(a.extend({width:b,height:d},c("transform"," translateZ("+f+"px)"))),k.surrounds.left.css(a.extend({width:b,height:d},c("transform","rotateY(-90deg) translateZ("+f+"px)"))),k.surrounds.right.css(a.extend({width:b,height:d},c("transform","rotateY(90deg)  translateZ("+f+"px)"))),k.surrounds.top.css(a.extend({width:b,height:b},c("transform","rotateX(90deg)  translateZ("+f+"px)"))),k.surrounds.bottom.css(a.extend({width:b,height:b},c("transform","rotateX(-90deg) translateZ("+f+"px)"))),i(k.surrounds.back,n.cube.back),i(k.surrounds.front,n.cube.front),i(k.surrounds.left,n.cube.left),i(k.surrounds.right,n.cube.right),i(k.surrounds.top,n.cube.top),i(k.surrounds.bottom,n.cube.bottom)}function f(a,b){for(var c=0;c<a.length;c++)if(a[c].test(b))return!0;return!1}function g(a){return f([/.*\.(jpg|jpeg|gif|png)/,/data:image\/(\w*);/],a)}function h(b,c){c&&("string"==typeof c?b.html(c):b.append(a(c)))}function i(a,b){b&&"string"==typeof b&&(g(b)?a.css({background:"url("+b+") no-repeat ","background-size":"100% 100%"}):a.css({background:b}))}function j(){var b=n.wallWidth,f=n.wallHeight;l.css(a.extend({position:"absolute",left:"50%",marginLeft:-b/2,top:"50%",marginTop:-f/2,width:b,height:f},c("perspectiveOrigin",["50%","50%"].join(" ")))),
//console.log('InitCube== width:[' + width + '],height:[' + height + ']');
d(b,f),e(b,f)}var k,l=this,m=void 0!==document.ontouchmove,n=a.extend(!0,{wallWidth:300,wallHeight:300,cube:{front:"white",back:"white",left:"#d3d3d3",right:"#d3d3d3",top:"#f3f3f3",bottom:"#ddd"},attach:{front:"",back:"",left:"",right:"",top:"",bottom:""},cubeClass:"cube",perspectiveRate:1,viewLimit:{xMin:void 0,xMax:void 0,yMin:void 0,yMax:void 0}},b);return function(){j(),k.jTouch({viewLimit:n.viewLimit,touchReverse:!0,keyDelta:20})}(),l.getCube=function(){return k},l}}(jQuery);