/**
 * Created by zhouzechen on 16/9/27.
 */
!function(a){function b(a){for(var b=0,d=a.length;b<d;b++)if("undefined"!=typeof c.style[a[b]])return a[b]}var c=document.createElement("div"),d="transform WebkitTransform MozTransform OTransform msTransform".split(" "),e=b(d),f="transitionDuration WebkitTransitionDuration MozTransitionDuration OTransitionDuration msTransitionDuration".split(" ");b(f);a.fn.jTouch=function(b){function c(a){return a%=360,a<=g.viewLimit.xMin?g.viewLimit.xMin:a>=g.viewLimit.xMax?g.viewLimit.xMax:a}function d(a){return a%=360,a<=g.viewLimit.yMin?g.viewLimit.yMin:a>=g.viewLimit.yMax?g.viewLimit.yMax:a}var f=this,g=a.extend(!0,{observer:a(document),keyWatch:!0,delay:50,viewLimit:{xMin:-10,xMax:10,yMin:-360,yMax:360},keyDelta:5},b),h={start:{}},i=void 0!==document.ontouchmove,j={ob:a(g.observer),x:0,y:0,el:f,perspectiveRate:1,perspective:null,changeDistance:function(a){j.perspectiveRate=a,j.perspective||(j.perspective=j.el.parent().css("perspective"),j.perspective&&(j.perspective=parseFloat(j.perspective))),j.perspective&&j.el.parent().css("perspective",j.perspective*j.perspectiveRate)},move:function(a){a&&("number"==typeof a.x&&(this.x=c(a.x)),"number"==typeof a.y&&(this.y=d(a.y))),
//console.log('move :x[' + this.x + '],y[' + this.y + ']');
this.el[0].style[e]="rotateX("+this.x+"deg) rotateY("+this.y+"deg)"},reset:function(){this.move({x:0,y:0})}};return j.duration=function(){return g.delay||0}(),g.keyWatch&&a(document).keydown(function(a){switch(a.keyCode){case 37:// left
j.move({y:j.y-g.keyDelta});break;case 38:// up
a.preventDefault(),j.move({x:j.x+g.keyDelta});
//viewport.changeDistance(viewport.perspectiveRate + 0.1);
break;case 39:// right
j.move({y:j.y+g.keyDelta});break;case 40:// down
a.preventDefault(),j.move({x:j.x-g.keyDelta});
//viewport.changeDistance(viewport.perspectiveRate - 0.1);
break;case 27://esc
j.reset()}}),j.ob.bind("mousedown touchstart",function(b){return delete h.last,!!a(b.target).is("a, iframe")||(b.originalEvent.touches?b=b.originalEvent.touches[0]:null,h.start.x=b.pageX,h.start.y=b.pageY,j.ob.bind("mousemove touchmove",function(a){
// Only perform rotation if one touch or mouse (e.g. still scale with pinch and zoom)
i&&a.originalEvent&&a.originalEvent.touches.length>1||(a.preventDefault(),
// Get touch co-ords
a.originalEvent.touches?a=a.originalEvent.touches[0]:null,j.el.trigger("move-viewport",{x:a.pageX,y:a.pageY}))}),void j.ob.bind("mouseup touchend",function(){j.ob.unbind("mousemove touchmove")}))}),j.el.bind("move-viewport",function(a,b){function c(a,b){return a>=b}
// Reduce movement on touch screens
//var movementScaleFactor = touch ? 4 : 1;
var d=i?4:5;h.last?(c(h.start.x,h.last.x)!=c(h.last.x,b.x)&&(h.start.x=h.last.x),c(h.start.y,h.last.y)!=c(h.last.y,b.y)&&(h.start.y=h.last.y)):h.last=h.start,j.move({x:j.x+parseInt((b.y-h.start.y)/d),y:j.y-parseInt((b.x-h.start.x)/d)}),h.last.x=b.x,h.last.y=b.y}),f}}(jQuery),/**
 * Created by zhouzechen on 16/9/27.
 */
function(a){a.fn.jRoom=function(b){function c(b,c){var d=[b,"-webkit-"+b,"-moz-"+b,"-o-"+b,"-ms-"+b],e={};return a.each(d,function(a,b){e[b]=c}),e}function d(b,d){if(!k){k=a('<div class="'+n.cubeClass+'"></div>'),k.css({position:"absolute",left:0,right:0,top:0,bottom:0}),k.css(c("transformStyle","preserve-3d")),k.css(c("transformOrigin","50% 50% 0"));var e=a('<div class="'+n.cubeClass+'-front"></div>'),f=a('<div class="'+n.cubeClass+'-back"></div>'),g=a('<div class="'+n.cubeClass+'-left"></div>'),i=a('<div class="'+n.cubeClass+'-right"></div>'),j=a('<div class="'+n.cubeClass+'-top"></div>'),m=a('<div class="'+n.cubeClass+'-bottom"></div>');k.append(e),k.append(f),k.append(g),k.append(i),k.append(j),k.append(m),k.surrounds={front:e,back:f,left:g,right:i,top:j,bottom:m},a(">div",k).css(a.extend({position:"absolute",top:0,left:0},c("userSelect","none"))),m.css({top:"auto",bottom:0}),h(k.surrounds.back,n.attach.back),h(k.surrounds.front,n.attach.front),h(k.surrounds.left,n.attach.left),h(k.surrounds.right,n.attach.right),h(k.surrounds.top,n.attach.top),h(k.surrounds.bottom,n.attach.bottom),l.append(k)}}function e(b,d){var e=.5*b*n.perspectiveRate;m&&(e=.4*b*n.perspectiveRate),l.css(a.extend({marginLeft:-b/2,marginTop:-d/2,width:b,height:d},c("perspective",.4*b*n.perspectiveRate)));var f=2-b/2;k.surrounds.back.css(a.extend({width:b,height:d},c("transform","rotateY(180deg) translateZ("+f+"px)"))),k.surrounds.front.css(a.extend({width:b,height:d},c("transform","translateZ("+-b/2+"px)"))),k.surrounds.left.css(a.extend({width:b,height:d},c("transform","rotateY(90deg) translateZ("+f+"px)"))),k.surrounds.right.css(a.extend({width:b,height:d},c("transform","rotateY(-90deg)  translateZ("+f+"px)"))),k.surrounds.top.css(a.extend({width:b,height:b},c("transform","rotateX(-90deg)  translateZ("+f+"px)"))),k.surrounds.bottom.css(a.extend({width:b,height:b},c("transform","rotateX(90deg) translateZ("+f+"px)"))),i(k.surrounds.back,n.cube.back),i(k.surrounds.front,n.cube.front),i(k.surrounds.left,n.cube.left),i(k.surrounds.right,n.cube.right),i(k.surrounds.top,n.cube.top),i(k.surrounds.bottom,n.cube.bottom)}function f(a,b){for(var c=0;c<a.length;c++)if(a[c].test(b))return!0;return!1}function g(a){return f([/.*\.(jpg|jpeg|gif|png)/,/data:image\/(\w*);/],a)}function h(b,c){c&&("string"==typeof c?b.html(c):b.append(a(c)))}function i(a,b){b&&"string"==typeof b&&(g(b)?a.css({background:"url("+b+") no-repeat ","background-size":"100% 100%"}):a.css({background:b}))}function j(){var b={width:n.wallWidth,height:n.wallHeight},f={width:a(window).width(),height:a(window).height()},g=Math.max(f.width,f.height),h=g,i=Math.floor(g*b.height/b.width)+1;h=Math.sqrt(h*h+i*i),i=Math.floor(h*b.height/b.width)+1,l.css(a.extend({position:"absolute",left:"50%",marginLeft:-h/2,top:"50%",marginTop:-i/2,width:h,height:i,backfaceVisibility:"hidden"},c("perspectiveOrigin",["50%","50%"].join(" ")))),
//console.log('InitCube== width:[' + width + '],height:[' + height + ']');
d(h,i),e(h,i)}var k,l=this,m=void 0!==document.ontouchmove,n=a.extend(!0,{wallWidth:300,wallHeight:300,cube:{front:"white",back:"white",left:"#d3d3d3",right:"#d3d3d3",top:"#f3f3f3",bottom:"#ddd"},attach:{front:"",back:"",left:"",right:"",top:"",bottom:""},cubeClass:"room-cube",perspectiveRate:1},b);return function(){j(),a(window).on("resize",function(){j()}),k.jTouch({viewLimit:n.viewLimit||{xMin:-10,xMax:10,yMin:-360,yMax:360}})}(),l.getCube=function(){return k},l}}(jQuery);